@model CallogApp.Models.Request

@{
    ViewData["Title"] = "Edit";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}


<div class="row">

    <a asp-action="Index">Back to List</a>
    <form asp-action="Edit" onsubmit="return validateForm()" name="myForm">

        <div class="col-md-7 polaroid mt-5">
            <h4 class="text-dark text-uppercase">User Request</h4>

            <div class="message">@ViewBag.Message</div>


            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            @*<div asp-validation-summary="All" class="text-danger"></div>*@
            @Html.Hidden("UserId")
            @Html.Hidden("DateCreated")
            @Html.Hidden("RespondedDate")
            @Html.Hidden("ResponseDate")
            @Html.Hidden("ResolvedDate")
            @Html.Hidden("step")
            @Html.Hidden("OtherDevice")
            @Html.Hidden("OtherIssue")
            @Html.Hidden("PhotoUrl")
            @Html.Hidden("ResponseInterval")
            @Html.Hidden("ResolutionInterval")



            <div class="form-group">
                <label asp-for="Subject" class="control-label"></label>
                <input asp-for="Subject" class="form-control" readonly />
                <span asp-validation-for="Subject" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="DepartmentId" class="control-label"></label>
                <label class="form-control" readonly>@ViewBag.Department</label>
                <div hidden><select asp-for="DepartmentId" class="form-control" asp-items="ViewBag.DepartmentId"></select></div>
            </div>
            <div class="row">
                <div class="form-group col-md-6">
                    <label asp-for="DeviceId" class="control-label"></label>
                    <label class="form-control" readonly>@ViewBag.Device</label>
                    <div hidden> <select asp-for="DeviceId" class="form-control" asp-items="ViewBag.DeviceId"></select></div>
                </div>
                <div class="form-group col-md-6">
                    <label class="control-label">Category</label>
                    <label class="form-control" readonly>@ViewBag.Issue</label>
                    <div hidden><select asp-for="IssueId" class="form-control" asp-items="ViewBag.IssueId"></select></div>
                </div>

            </div>

            <div class="form-group">
                <label class="control-label">Description</label>
                <textarea asp-for="Message" class="form-control" rows="5" readonly id="mytextarea3"></textarea>
                <span asp-validation-for="Message" class="text-danger"></span>
            </div>
        </div>

        <div class="col-md-5 polaroid mt-5">
            <h6>ADMIN -- EDIT REQUEST</h6>
            <div asp-validation-summary="All" class="text-danger"></div>
            @if (@ViewBag.progressMessage != null)
            {
                <div class="alert alert-danger  alert-dismissible" role="alert">
                    @ViewBag.progressMessage
                </div>

            }

            @if (@ViewBag.reasonMessage != null)
            {

                <div class="alert alert-danger  alert-dismissible" role="alert">
                    @ViewBag.reasonMessage
                </div>
            }
            <div class="row" id="ITStaffIdDiv">
                <div class="form-group col-md-6" id="asignTo">
                    <label asp-for="ITStaffId" class="control-label"></label>
                    <select asp-for="ITStaffId" class="form-control" asp-items="ViewBag.ITStaffId"></select>
                </div>
                <div class="form-group col-md-6" id="level">
                    <label class="control-label">Priority</label>
                    <select asp-for="LevelId" class="form-control" asp-items="ViewBag.LevelId"></select>
                </div>
            </div>
            <div class="row">

                <div class="form-group col-md-6" id="StatusDiv">
                    <label asp-for="StatusId" class="control-label"></label>
                    <select class="status form-control" asp-for="StatusId" asp-items="ViewBag.StatusId"></select>
                    <span id="sta" style="color:red"></span>
                </div>
                <div class="form-group col-md-6" id="resolved_id">
                    <label asp-for="ResolvedBy" class="control-label"></label>
                    <input asp-for="ResolvedBy" class="form-control" />
                    <span asp-validation-for="ResolvedBy" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group" id="resolution_id">
                <label class="control-label">Resolution</label>
                <textarea asp-for="Resolution" class="form-control" rows="5" id="mytextarea"></textarea>
                <span asp-validation-for="Resolution" class="text-danger"></span>
            </div>

            <div class="form-group" id="reason_id">
                <label class="control-label">Reason for delay</label>
                <textarea asp-for="ReasonForHigh" class="form-control" rows="5" id="mytextarea2"></textarea>
                <span asp-validation-for="ReasonForHigh" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Update" class="btn btn-block btn-primary text-white" />
            </div>
        </div>

    </form>
</div>
<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts{

    <script>

        $(document).ready(function () {


            var Level_x = document.getElementById("LevelId").selectedIndex;
            var Level_y = document.getElementById("LevelId").options;

            var x = document.getElementById("StatusId").selectedIndex;
            var y = document.getElementById("StatusId").options;
            var reasonx = $('#ReasonForHigh').text();

            var xits = document.getElementById("ITStaffId").selectedIndex;
            var yits = document.getElementById("ITStaffId").options;

            //check if Level is High and Status is Pending
            if (yits[xits].text == "Pending") {

                $('#reason_id').hide();
                $("#StatusDiv").hide();
                $("#resolved_id").hide();
                $("#resolution_id").hide();

            }

            else if (y[x].text == "Pending" && yits[xits].text != "Pending" && Level_y[Level_x].text == "High") {

                $('#reason_id').show();
                $("#StatusDiv").show();
                $("#resolved_id").hide();
                $("#resolution_id").hide();

            }
            else if (y[x].text == "Pending" && yits[xits].text != "Pending" && Level_y[Level_x].text == "Low") {

                $('#reason_id').hide();
                $("#StatusDiv").show();
                $("#resolved_id").hide();
                $("#resolution_id").hide();
            }
            else if (y[x].text == "Pending" && yits[xits].text != "Pending" && Level_y[Level_x].text == "Medium") {

                $('#reason_id').hide();
                $("#StatusDiv").show();
                $("#resolved_id").hide();
                $("#resolution_id").hide();
            }
            else if (y[x].text != "Pending" && yits[xits].text != "Pending") {

                $('#reason_id').hide();
                $("#StatusDiv").show();
                $("#resolved_id").show();
                $("#resolution_id").show();
            }

        });

        //Dislay error alert and fade it
        $(".alert-dismissible").fadeTo(4000, 500).slideUp(500, function () {
            $(".alert-dismissible").alert('close');
        });

        //check selctet changes
        $(function () {

            $("#level").change(function () {
                var selectedText = $(this).find("option:selected").text();

                if (selectedText !== "High") {
                    $('#reason_id').hide();
                }
            });
        });
    </script>

    <script src="~/js/ckeditor/ckeditor.js"></script>
    <script>
         CKEDITOR.replace('mytextarea');
         CKEDITOR.replace('mytextarea2');
         CKEDITOR.replace('mytextarea3');

           
    </script>
}

